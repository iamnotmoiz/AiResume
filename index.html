<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResumeAutopilot | AI Portfolio Architect</title>
    
    <!-- Tailwind CSS -->
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    
    <!-- React & Babel -->
    <script src="[https://unpkg.com/react@18/umd/react.production.min.js](https://unpkg.com/react@18/umd/react.production.min.js)"></script>
    <script src="[https://unpkg.com/react-dom@18/umd/react-dom.production.min.js](https://unpkg.com/react-dom@18/umd/react-dom.production.min.js)"></script>
    <script src="[https://unpkg.com/@babel/standalone/babel.min.js](https://unpkg.com/@babel/standalone/babel.min.js)"></script>
    
    <!-- PDF.js for Client-Side Text Extraction -->
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js](https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js)"></script>
    
    <!-- Lucide Icons -->
    <script src="[https://unpkg.com/lucide@latest](https://unpkg.com/lucide@latest)"></script>
    
    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = '[https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js](https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js)';
        
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('[https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap)');
        @import url('[https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap](https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap)'); /* For Tesla/Tech themes */
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
        .preview-frame { width: 100%; height: 100%; border: none; background: white; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden selection:bg-indigo-100 selection:text-indigo-700">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icon Component ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // --- Helper: Robust HTML Extractor ---
        const extractHtmlCode = (text) => {
            if (!text) return '';
            // 1. Try extracting from markdown blocks
            const match = text.match(/```html([\s\S]*?)```/);
            if (match) return match[1].trim();
            
            // 2. If no markdown, check for DOCTYPE
            const docTypeIndex = text.indexOf('<!DOCTYPE html>');
            if (docTypeIndex !== -1) return text.substring(docTypeIndex);
            
            // 3. Fallback to raw text
            return text.trim();
        };

        // --- Main Application ---
        const App = () => {
            // -- State --
            const [step, setStep] = useState(1); // 1: Input, 2: Generating, 3: Preview, 4: Deploying, 5: Success
            
            // Input Data
            const [resumeFile, setResumeFile] = useState(null);
            const [resumeText, setResumeText] = useState('');
            const [jobLink, setJobLink] = useState('');
            const [selectedTheme, setSelectedTheme] = useState('Apple');
            const [githubToken, setGithubToken] = useState(() => localStorage.getItem('rt_gh_token') || '');
            
            // Process Data
            const [generatedHtml, setGeneratedHtml] = useState('');
            const [statusMessage, setStatusMessage] = useState('');
            const [error, setError] = useState('');
            const [liveUrl, setLiveUrl] = useState('');
            
            // Refinement State
            const [refinementPrompt, setRefinementPrompt] = useState('');
            const [isRefining, setIsRefining] = useState(false);
            
            // Persist Token
            useEffect(() => { localStorage.setItem('rt_gh_token', githubToken); }, [githubToken]);

            // --- PDF Extraction Logic ---
            const extractTextFromPDF = async (file) => {
                setStatusMessage("Reading your resume...");
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    let fullText = "";
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + "\n";
                    }
                    setResumeText(fullText);
                    setResumeFile(file);
                    return fullText;
                } catch (err) {
                    setError("Failed to read PDF. Please ensure it is a valid text-based PDF.");
                    console.error(err);
                    return null;
                }
            };

            const handleFileSelect = async (e) => {
                const file = e.target.files[0];
                if (file) await extractTextFromPDF(file);
            };

            // --- AI Generation Logic ---
            const generateWebsite = async () => {
                if (!resumeText || !jobLink) {
                    setError("Please upload a resume and provide a job description.");
                    return;
                }

                setStep(2); // Generating
                setError('');
                setStatusMessage("Analyzing your career history...");

                // LOCATION 1: Main Generation
                const apiKey = "AIzaSyCQJkjKZQkw15rgcrQzjG8rZ-Kneefg1pc"; //
                
                if (!apiKey || apiKey.includes("*insert")) {
                    setError("Missing API Key. Please edit the code to insert your Google AI Studio Key.");
                    setStep(1);
                    return;
                }

                // Specific Design Systems
                const themes = {
                    'Apple': {
                        description: 'High-end iOS18/VisionOS Aesthetic',
                        specs: `
                            - Background: Soft grays/whites (bg-slate-50).
                            - Glassmorphism: Heavy use of backdrop-blur-xl, bg-white/70, border-white/40.
                            - Typography: Inter/San Francisco, tight tracking, heavy bold headers.
                            - Shapes: Deeply rounded corners (rounded-[2.5rem]).
                            - Animation: Smooth, spring-like transitions, fade-in-up elements.
                            - Layout: Centralized, lots of whitespace.
                        `
                    },
                    'Google': {
                        description: 'Material Design 3 / Pixel Aesthetic',
                        specs: `
                            - Background: Playful pastels or clean white (bg-[#f8f9fa]).
                            - Cards: Elevated, rounded-2xl, shadow-sm hover:shadow-md transition-all.
                            - Typography: Google Sans style (Roboto/Inter), clearly defined hierarchy.
                            - Color: Use "Google Blue" (#4285F4) or dynamic color accents.
                            - UI Elements: Floating Action Button (FAB) for contact, pill-shaped tags for skills.
                        `
                    },
                    'Tesla': {
                        description: 'Futuristic, Technical, Automotive Minimal',
                        specs: `
                            - Background: Dark Mode ONLY (bg-neutral-950 or black).
                            - Typography: 'Space Grotesk' or technical sans-serif. Uppercase headers.
                            - Color: Stark White text, Red accents (#E31937), Dark Grey borders.
                            - Shapes: Sharp corners or minimal rounding (rounded-sm).
                            - Layout: Grid lines, technical specs box, high contrast.
                            - Effect: Glowing borders or text on hover.
                        `
                    }
                };

                const systemPrompt = `
                    You are a world-class Creative Developer & UI/UX Designer.
                    Your goal is to transform a resume into an AWARD-WINNING PERSONAL WEBSITE based on the "${selectedTheme}" design language.
                    
                    DESIGN LANGUAGE SPECS (${selectedTheme}):
                    ${themes[selectedTheme].specs}

                    STRUCTURE & CONTENT REQUIREMENTS:
                    1.  **Header/Nav**: Minimal, sticky, glassmorphism.
                    2.  **Hero Section**:
                        - Large, bold typography introducing the candidate.
                        - A short, punchy bio tailored to the [TARGET JOB].
                        - Two call-to-action buttons (e.g., "View Work", "Contact").
                    3.  **Experience Timeline (Crucial)**:
                        - Create a visually stunning VERTICAL TIMELINE.
                        - Use a central line with nodes.
                        - Each job must be a "Card" branching off the timeline.
                        - Inside the card: Role, Company, Date, and 2-3 bullet points tailored to the job description.
                        - Use Lucide icons for each role context.
                    4.  **Skills Matrix**: A modern grid or flex layout showing technical skills.
                    5.  **Projects**: Card-based grid showing relevant work.
                    
                    INTERACTIVITY & ANIMATION:
                    - Add 'animate-fade-in-up' classes (you must define keyframes in a <style> tag or use Tailwind's animate-bounce/pulse sparingly).
                    - Ensure hover states on ALL interactive elements (transform: scale(1.02)).
                    - Smooth scrolling for anchor links.

                    TECHNICAL CONSTRAINTS:
                    - OUTPUT: Single HTML file.
                    - CSS: Tailwind CSS (CDN provided).
                    - ICONS: Lucide Icons (data-lucide="icon-name").
                    - IMAGES: Do NOT include a profile photo. Use a creative typography monogram or initials (e.g., inside a circle) for the branding logo instead.
                    - DATA: STRICTLY use the [RESUME TEXT]. Do not invent facts.

                    Generate the full, run-ready HTML file now.
                `;

                const userMessage = `
                    [RESUME TEXT]:
                    ${resumeText.substring(0, 8000)} 

                    [TARGET JOB DESCRIPTION]:
                    ${jobLink}

                    Create the ${selectedTheme}-themed website code.
                `;

                try {
                    setStatusMessage(`Designing ${selectedTheme} interface...`);
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey.trim()}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userMessage }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            // Add safety settings to prevent false positives on resumes
                            safetySettings: [
                                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                            ]
                        })
                    });

                    setStatusMessage("Writing code...");
                    const data = await response.json();
                    
                    if (data.error) throw new Error(data.error.message || "API Error");
                    
                    let rawText = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                    let html = extractHtmlCode(rawText);
                    
                    if (html.length < 100) throw new Error("Generated code was too short. Please try again.");

                    setGeneratedHtml(html);
                    setStep(3); // Preview
                } catch (err) {
                    console.error("AI Gen Error:", err);
                    setError("Generation failed: " + err.message);
                    setStep(1);
                }
            };

            // --- Refinement Logic ---
            const handleRefinement = async () => {
                if (!refinementPrompt) return;
                
                setIsRefining(true);
                
                // LOCATION 2: Refinement/Chat Bar
                const apiKey = "AIzaSyCQJkjKZQkw15rgcrQzjG8rZ-Kneefg1pc"; //

                if (!apiKey || apiKey.includes("*insert")) {
                    alert("Please enter your API Key in the code for refinement to work.");
                    setIsRefining(false);
                    return;
                }

                const systemPrompt = `
                    You are an expert web developer assisting a user in refining a portfolio website.
                    Your task is to take the provided HTML code and modify it according to the USER REQUEST.
                    
                    RULES:
                    1. Return ONLY the full, updated HTML code. No markdown, no explanations.
                    2. Maintain the existing responsive design and interactivity.
                    3. Do not break existing scripts or tailwind setup.
                `;

                const userMessage = `
                    CURRENT HTML CODE:
                    ${generatedHtml}

                    USER REQUEST:
                    ${refinementPrompt}

                    Update the code now.
                `;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey.trim()}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userMessage }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                             safetySettings: [
                                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                            ]
                        })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message || "API Refinement Error");

                    let rawText = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                    let html = extractHtmlCode(rawText);

                    setGeneratedHtml(html);
                    setRefinementPrompt('');
                } catch (err) {
                    console.error("Refinement Error:", err);
                    alert("Refinement failed: " + err.message);
                } finally {
                    setIsRefining(false);
                }
            };

            // --- Deployment Logic ---
            const deployToGitHub = async () => {
                if (!githubToken) {
                    setError("GitHub Token required for deployment.");
                    return;
                }

                setStep(4); // Deploying
                setStatusMessage("Initializing repository...");

                const repoName = `portfolio-${selectedTheme.toLowerCase()}-${Date.now()}`;
                const headers = {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                };

                try {
                    const repoRes = await fetch('[https://api.github.com/user/repos](https://api.github.com/user/repos)', {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({ name: repoName, auto_init: true })
                    });
                    const repoData = await repoRes.json();
                    if (!repoRes.ok) throw new Error(repoData.message);

                    setStatusMessage("Uploading tailored website...");

                    await fetch(`https://api.github.com/repos/${repoData.full_name}/contents/index.html`, {
                        method: 'PUT',
                        headers,
                        body: JSON.stringify({
                            message: "Deploy tailored resume",
                            content: btoa(unescape(encodeURIComponent(generatedHtml)))
                        })
                    });

                    setStatusMessage("Configuring GitHub Pages...");

                    await fetch(`https://api.github.com/repos/${repoData.full_name}/pages`, {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({ source: { branch: 'main' } })
                    });

                    setLiveUrl(`https://${repoData.owner.login}.github.io/${repoName}/`);
                    setStep(5);

                } catch (err) {
                    setError("Deployment failed: " + err.message);
                    setStep(3);
                }
            };

            // --- Render Steps ---

            const renderInput = () => (
                <div className="max-w-5xl mx-auto pt-10 px-6 animate-slide-up pb-20 overflow-y-auto h-full">
                    <header className="text-center mb-10">
                        <div className="inline-flex items-center justify-center p-3 bg-indigo-100 rounded-2xl mb-4 text-indigo-600">
                            <Icon name="sparkles" size={32} />
                        </div>
                        <h1 className="text-4xl md:text-6xl font-black tracking-tight text-slate-900 mb-4">
                            Resume<span className="text-indigo-600">Autopilot</span>
                        </h1>
                        <p className="text-lg text-slate-500 font-medium max-w-xl mx-auto">
                            Turn your PDF into an interactive, job-winning website.
                        </p>
                    </header>

                    <div className="grid lg:grid-cols-12 gap-8">
                        {/* Left: Resume Upload */}
                        <div className="lg:col-span-5 space-y-6">
                            <div className="bg-white p-8 rounded-3xl shadow-xl shadow-slate-200 border border-slate-100 flex flex-col items-center text-center hover:border-indigo-200 transition-colors h-full justify-center">
                                <div className={`w-20 h-20 rounded-full flex items-center justify-center mb-4 transition-all duration-500 ${resumeFile ? 'bg-green-100 text-green-600 scale-110' : 'bg-slate-100 text-slate-400'}`}>
                                    <Icon name={resumeFile ? "check" : "file-up"} size={36} />
                                </div>
                                <h3 className="font-bold text-xl mb-2">{resumeFile ? "Resume Synced" : "Upload Resume"}</h3>
                                <p className="text-sm text-slate-400 mb-6 px-4">
                                    {resumeFile ? resumeFile.name : "Select your PDF. We'll extract your history locally."}
                                </p>
                                
                                <label className="cursor-pointer bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold hover:bg-slate-800 transition-transform active:scale-95 shadow-lg shadow-slate-200/50">
                                    <span>{resumeFile ? "Replace File" : "Select PDF"}</span>
                                    <input type="file" className="hidden" accept=".pdf" onChange={handleFileSelect} />
                                </label>
                            </div>
                        </div>

                        {/* Right: Config */}
                        <div className="lg:col-span-7 space-y-6">
                            {/* Theme Selector */}
                            <div className="bg-white p-6 rounded-3xl shadow-lg border border-slate-100">
                                <div className="flex items-center gap-2 mb-4">
                                    <Icon name="palette" className="text-indigo-600" size={18}/>
                                    <label className="text-xs font-bold uppercase text-slate-500 tracking-wider">Select Style</label>
                                </div>
                                <div className="grid grid-cols-3 gap-3">
                                    {[
                                        { id: 'Apple', icon: 'smartphone', color: 'bg-slate-100' },
                                        { id: 'Google', icon: 'layout-grid', color: 'bg-blue-50' },
                                        { id: 'Tesla', icon: 'zap', color: 'bg-neutral-900 text-white' }
                                    ].map(theme => (
                                        <button 
                                            key={theme.id}
                                            onClick={() => setSelectedTheme(theme.id)}
                                            className={`relative overflow-hidden group p-4 rounded-2xl text-left border transition-all duration-300 ${selectedTheme === theme.id ? 'ring-2 ring-indigo-500 border-transparent shadow-md' : 'border-slate-200 hover:border-slate-300'}`}
                                        >
                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center mb-2 ${theme.color} ${theme.id === 'Tesla' ? 'text-white' : 'text-slate-700'}`}>
                                                <Icon name={theme.icon} size={16} />
                                            </div>
                                            <span className="font-bold text-sm block">{theme.id}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Job Link */}
                            <div className="bg-white p-6 rounded-3xl shadow-lg border border-slate-100">
                                <div className="flex items-center gap-2 mb-4">
                                    <Icon name="target" className="text-indigo-600" size={18}/>
                                    <label className="text-xs font-bold uppercase text-slate-500 tracking-wider">Target Opportunity</label>
                                </div>
                                <div className="flex items-center gap-3 bg-slate-50 p-4 rounded-2xl border border-slate-200 focus-within:ring-2 ring-indigo-500 focus-within:border-transparent transition-all">
                                    <input 
                                        type="text" 
                                        className="bg-transparent w-full outline-none font-medium text-slate-800 placeholder:text-slate-400"
                                        placeholder="Paste Job Description (Recommended)..."
                                        value={jobLink}
                                        onChange={(e) => setJobLink(e.target.value)}
                                    />
                                </div>
                            </div>
                            
                            <button 
                                onClick={generateWebsite}
                                disabled={!resumeText || !jobLink}
                                className="w-full bg-indigo-600 text-white p-5 rounded-2xl font-black text-lg shadow-xl shadow-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-indigo-700 hover:scale-[1.01] transition-all flex items-center justify-center gap-3"
                            >
                                <Icon name="wand-2" className={!resumeText || !jobLink ? "" : "animate-pulse"} /> 
                                {selectedTheme === 'Tesla' ? 'Initialize System' : 'Generate Website'}
                            </button>
                        </div>
                    </div>
                </div>
            );

            const renderLoading = () => (
                <div className="flex flex-col items-center justify-center h-screen animate-fade-in bg-slate-50">
                    <div className="relative w-32 h-32 mb-8">
                        <div className="absolute inset-0 border-8 border-slate-200 rounded-full"></div>
                        <div className="absolute inset-0 border-8 border-t-indigo-600 rounded-full animate-spin"></div>
                        <div className="absolute inset-0 flex items-center justify-center animate-pulse">
                            <Icon name="code-2" size={40} className="text-indigo-600" />
                        </div>
                    </div>
                    <h2 className="text-3xl font-black text-slate-900 mb-2 tracking-tight">Crafting {selectedTheme} Design</h2>
                    <p className="text-slate-500 font-medium animate-pulse">{statusMessage}</p>
                </div>
            );

            const renderPreview = () => (
                <div className="h-screen flex flex-col animate-fade-in bg-slate-100">
                    {/* Toolbar */}
                    <div className="bg-white h-20 border-b flex items-center justify-between px-6 shadow-sm z-10 shrink-0 gap-4">
                        <button onClick={() => setStep(1)} className="text-slate-500 hover:text-slate-800 flex items-center gap-2 text-sm font-semibold transition-colors shrink-0">
                            <Icon name="arrow-left" size={16}/> <span className="hidden sm:inline">Back</span>
                        </button>
                        
                        {/* AI Refinement Bar */}
                        <div className="flex-1 max-w-2xl mx-auto flex items-center gap-2 bg-slate-50 p-1.5 rounded-xl border border-slate-200 focus-within:ring-2 ring-indigo-500 focus-within:border-transparent transition-all shadow-inner">
                            <div className="p-2 bg-indigo-100 text-indigo-600 rounded-lg">
                                <Icon name={isRefining ? "loader-2" : "sparkles"} className={isRefining ? "animate-spin" : ""} size={16} />
                            </div>
                            <input 
                                type="text"
                                value={refinementPrompt}
                                onChange={(e) => setRefinementPrompt(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && handleRefinement()}
                                placeholder={isRefining ? "AI is refining your site..." : "Ask AI to change colors, fonts, layout..."}
                                className="flex-1 bg-transparent text-sm outline-none placeholder:text-slate-400"
                                disabled={isRefining}
                            />
                            <button 
                                onClick={handleRefinement}
                                disabled={!refinementPrompt || isRefining}
                                className="px-4 py-2 bg-indigo-600 text-white rounded-lg text-xs font-bold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Update
                            </button>
                        </div>

                        <div className="flex items-center gap-3 shrink-0">
                            <div className="hidden lg:flex items-center gap-2 mr-4 group">
                                <div className="bg-slate-100 border border-slate-200 rounded-lg px-3 py-1.5 flex items-center gap-2 focus-within:ring-2 ring-indigo-500 transition-all">
                                    <Icon name="key" size={12} className="text-slate-400"/>
                                    <input 
                                        type="password" 
                                        placeholder="GitHub Token" 
                                        value={githubToken}
                                        onChange={(e) => setGithubToken(e.target.value)}
                                        className="bg-transparent text-xs w-28 outline-none"
                                    />
                                </div>
                            </div>
                            <button onClick={deployToGitHub} className="bg-slate-900 text-white px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-800 flex items-center gap-2 transition-transform active:scale-95 shadow-lg shadow-slate-200">
                                <Icon name="rocket" size={16} /> Deploy
                            </button>
                        </div>
                    </div>

                    {/* Iframe Preview */}
                    <div className="flex-1 p-4 md:p-8 flex justify-center overflow-hidden bg-slate-100/50">
                        <div className="relative w-full max-w-[1400px] bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200 ring-4 ring-slate-200/50">
                            {isRefining && (
                                <div className="absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center animate-fade-in">
                                    <Icon name="loader-2" className="animate-spin text-indigo-600 mb-2" size={40} />
                                    <p className="font-bold text-slate-600 animate-pulse">Applying changes...</p>
                                </div>
                            )}
                            <iframe 
                                srcDoc={generatedHtml} 
                                className="absolute inset-0 w-full h-full bg-white" 
                                title="Website Preview"
                                sandbox="allow-scripts allow-same-origin"
                            />
                        </div>
                    </div>
                </div>
            );

            const renderSuccess = () => (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-50 animate-fade-in relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none">
                        <div className="absolute top-10 left-10 w-96 h-96 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl animate-blob"></div>
                        <div className="absolute top-10 right-10 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000"></div>
                    </div>

                    <div className="glass-panel p-12 rounded-[2.5rem] text-center max-w-lg shadow-2xl relative z-10 mx-4">
                        <div className="w-24 h-24 bg-green-500 text-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-green-200 animate-[bounce_1s_ease-in-out_1]">
                            <Icon name="check" size={48} strokeWidth={4} />
                        </div>
                        <h2 className="text-4xl font-black text-slate-800 mb-4 tracking-tight">We're Live!</h2>
                        <p className="text-slate-500 mb-8 font-medium">Your {selectedTheme} site is being provisioned by GitHub Pages. It will be ready in ~60 seconds.</p>
                        
                        <div className="bg-white p-2 rounded-xl border border-slate-200 mb-8 flex items-center gap-2 shadow-sm">
                            <div className="p-3 bg-slate-100 rounded-lg"><Icon name="globe" className="text-slate-500" /></div>
                            <input readOnly value={liveUrl} className="w-full bg-transparent text-sm font-mono text-slate-600 outline-none truncate" />
                            <a href={liveUrl} target="_blank" className="p-3 hover:bg-indigo-50 rounded-lg text-indigo-600 transition-colors">
                                <Icon name="external-link" size={20} />
                            </a>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => setStep(1)} className="py-4 rounded-xl border-2 border-slate-200 font-bold text-slate-600 hover:bg-slate-50 hover:border-slate-300 transition-all">
                                Create New
                            </button>
                            <a href={liveUrl} target="_blank" className="py-4 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2">
                                Visit Site <Icon name="arrow-right" size={16}/>
                            </a>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800">
                    {error && (
                        <div className="fixed top-6 left-1/2 -translate-x-1/2 bg-red-500 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 z-50 animate-slide-up max-w-md w-full">
                            <div className="bg-white/20 p-2 rounded-full"><Icon name="alert-triangle" size={24} /></div>
                            <div className="flex-1">
                                <h4 className="font-bold">Error</h4>
                                <p className="text-sm opacity-90">{error}</p>
                            </div>
                            <button onClick={() => setError('')} className="opacity-70 hover:opacity-100"><Icon name="x" size={20}/></button>
                        </div>
                    )}

                    {step === 1 && renderInput()}
                    {step === 2 && renderLoading()}
                    {step === 3 && renderPreview()}
                    {step === 4 && renderLoading()}
                    {step === 5 && renderSuccess()}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>